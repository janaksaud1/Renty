// Updated Room/Flat Rental Website with Firebase, User Login, Google Maps, and Admin Panel

// Tech Stack: HTML, CSS, JavaScript, Firebase (Firestore + Auth), Google Maps API

// index.html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RentHub Kathmandu</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
</head>
<body>
  <h1>RentHub Kathmandu</h1>
  <div id="auth-section">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
    <button onclick="logout()">Logout</button>
  </div>

  <div id="post-section" style="display:none;">
    <h2>Post a Room</h2>
    <input type="text" id="title" placeholder="Room Title">
    <textarea id="description" placeholder="Description"></textarea>
    <input type="text" id="address" placeholder="Address">
    <button onclick="getLocation()">Pin on Map</button>
    <div id="map" style="width:100%; height:300px;"></div>
    <button onclick="postListing()">Submit</button>
  </div>

  <div id="listings"></div>

  <script src="app.js"></script>
</body>
</html>

// style.css
body { font-family: Arial; padding: 20px; }
input, textarea, button { display: block; margin: 10px 0; width: 100%; padding: 10px; }

// app.js
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function signup() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  auth.createUserWithEmailAndPassword(email, password)
    .then(() => alert("Signed Up!"))
    .catch(err => alert(err.message));
}

function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById("post-section").style.display = "block";
      loadListings();
    })
    .catch(err => alert(err.message));
}

function logout() {
  auth.signOut().then(() => {
    document.getElementById("post-section").style.display = "none";
  });
}

let currentLat = 0, currentLng = 0;
function getLocation() {
  navigator.geolocation.getCurrentPosition(position => {
    currentLat = position.coords.latitude;
    currentLng = position.coords.longitude;
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: currentLat, lng: currentLng },
      zoom: 15
    });
    new google.maps.Marker({ position: { lat: currentLat, lng: currentLng }, map });
  });
}

function postListing() {
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;
  const address = document.getElementById("address").value;
  db.collection("listings").add({
    title, description, address,
    lat: currentLat, lng: currentLng,
    status: "pending",
    postedBy: auth.currentUser.email
  }).then(() => alert("Posted. Awaiting Approval."));
}

function loadListings() {
  db.collection("listings").where("status", "==", "approved").onSnapshot(snapshot => {
    const listings = document.getElementById("listings");
    listings.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      listings.innerHTML += `<div><h3>${data.title}</h3><p>${data.description}</p><p>${data.address}</p></div>`;
    });
  });
}
